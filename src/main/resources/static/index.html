<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WLemos Imóveis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f2f2f2;
      color: #333;
    }
    .navbar, .footer {
      background-color: #444;
    }
    .card {
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .logo-placeholder {
      width: 120px;
      height: 50px;
      background: #ccc;
      text-align: center;
      line-height: 50px;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="/img/logo colorida tr@6x.png" alt="WLemos Imóveis Logo" width="70" height="48" class="ms-5 me-3">
      <img src="/img/texto.png" alt="WLemos Imóveis Texto" height="32" class="align-middle">
    </a>
    <button type="button" class="btn btn-outline-light ms-auto" data-bs-toggle="modal" data-bs-target="#loginModal">
      Login Corretor
    </button>
  </div>
</nav>

  <div class="container mt-4">
    <h2 class="mb-4">Buscar Imóveis</h2>
    <form id="searchForm" class="row g-3">
      <div class="col-md-3">
        <input type="text" class="form-control" name="cidade" placeholder="Cidade">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" name="bairro" placeholder="Bairro">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" name="rua" placeholder="Rua">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" name="situacao" placeholder="Situação">
      </div>

      <div class="col-md-3">
        <input type="text" class="form-control" name="tipo" placeholder="Tipo de Imóvel">
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control" name="precoMin" placeholder="Preço mínimo">
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control" name="precoMax" placeholder="Preço máximo">
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control" name="tamanhoMin" placeholder="Tamanho mínimo">
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control" name="tamanhoMax" placeholder="Tamanho máximo">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" name="descricao" placeholder="Características">
      </div>
      <div class="col-md-3">
        <input type="date" class="form-control" name="dataCadastro" placeholder="Data de Cadastro">
      </div>

      <div class="col-md-12">
        <button type="submit" class="btn btn-dark w-100">Buscar</button>
      </div>
    </form>
    <div class="row mt-4" id="resultados">
    </div>
    <div id="dashboardSection">
      <h4 class="mt-5">Imóveis Disponíveis</h4>
      <div id="dashboardImoveis" class="row row-cols-1 row-cols-md-2 g-4"></div>
    </div>
  </div>

  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Login do Corretor</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="loginForm">
            <input type="text" class="form-control mb-3" placeholder="Email" name="email">
            <input type="password" class="form-control mb-3" placeholder="Senha" name="senha">
            <button type="submit" class="btn btn-dark w-100">Entrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-5">
  <div id="dashboardImoveis" class="row row-cols-1 row-cols-md-2 g-4"></div>
</div>
<script>
  async function carregarImoveis() {
    const container = document.getElementById('dashboardImoveis');
    container.innerHTML = '';

    try {
      const res = await fetch('http://localhost:8081/imoveis/todos');
      const imoveis = await res.json();

      imoveis.forEach(imovel => {
        const card = document.createElement('div');
        card.className = 'col';
        card.innerHTML = `
          <div class="card p-3">
            <h5>${imovel.nome}</h5>
            <p>${imovel.descricao}</p>
            <p><strong>Local:</strong> 
              ${imovel.endereco?.cidade || '-'}, 
              ${imovel.endereco?.bairro || '-'}, 
              ${imovel.endereco?.rua || '-'}
            </p>
            <p><strong>Preço:</strong> R$ ${imovel.preco} | <strong>Tamanho:</strong> ${imovel.tamanho} m²</p>
            <p><strong>Tipo:</strong> ${imovel.tipo} | <strong>Situação:</strong> ${imovel.situacao}</p>
          </div>
        `;
        container.appendChild(card);
      });
    } catch (err) {
      console.error('Erro ao carregar imóveis do dashboard', err);
    }
  }

  window.addEventListener('load', carregarImoveis);
</script>
  <footer class="footer text-white py-2 mt-5" style="background-color: #333; min-height: 0;">
    <div class="container">
      <div class="row justify-content-center align-items-start text-center">
        <!-- logo e dados -->
        <div class="col-lg-4 col-md-6 mb-2">
          <img src="/img/logo completa.png" alt="Logo WLemos Imóveis" width="100" class="mb-1">
          <ul class="list-unstyled small mt-2 mb-1">
            <li><strong>CRECI:</strong> 24693</li>
            <li><strong>CNPJ:</strong> 54.432.135/0001-55 MATRIZ</li>
            <li><strong>Endereço:</strong> R. JAIME VASCONCELOS, 457</li>
            <li><strong>CEP:</strong> 60165-260</li>
          </ul>
        </div>
        <!-- fale conosco -->
        <div class="col-lg-4 col-md-6 mb-2">
          <h6 class="fw-bold mb-2">Fale Conosco!</h6>
          <ul class="list-unstyled mb-1">
            <li class="mb-1">
              <i class="bi bi-whatsapp me-2"></i>
              (85) 99169-7811
            </li>
            <li>
              <i class="bi bi-whatsapp me-2"></i>
              (85) 98107-0295
            </li>
          </ul>
        </div>
        <!-- redes sociais -->
        <div class="col-lg-4 col-md-12 mb-2">
          <h6 class="fw-bold mb-2">Siga-nos nas redes!</h6>
          <a href="https://www.instagram.com/wlemos.negocios/" class="text-white me-2" title="Instagram">
            <i class="bi bi-instagram" style="font-size: 1.5rem;"></i>
          </a>
        </div>
      </div>
      <div class="text-center mt-2 small">&copy; 2025 WLemos Imóveis</div>
    </div>
  </footer>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <script>
    document.getElementById('searchForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      document.getElementById('dashboardSection').style.display = 'none'; 
      document.getElementById('dashboardImoveis').innerHTML = ''; 
      const formData = new FormData(this);
      const params = Object.fromEntries(formData.entries());
      const resultados = document.getElementById('resultados');
      resultados.innerHTML = '';

      const queryParams = new URLSearchParams();

      if (params.precoMin) queryParams.append('precoMin', params.precoMin);
      if (params.precoMax) queryParams.append('precoMax', params.precoMax);
      if (params.tamanhoMin) queryParams.append('tamanhoMin', params.tamanhoMin);
      if (params.tamanhoMax) queryParams.append('tamanhoMax', params.tamanhoMax);
      if (params.tipo) queryParams.append('tipo', params.tipo);
      if (params.situacao) queryParams.append('situacao', params.situacao);
      if (params.cidade) queryParams.append('cidade', params.cidade);
      if (params.bairro) queryParams.append('bairro', params.bairro);
      if (params.rua) queryParams.append('rua', params.rua);
      if (params.descricao) queryParams.append('descricao', params.descricao);
      if (params.dataCadastro) queryParams.append('dataCadastro', params.dataCadastro);

      let url = `/imoveis/buscar?${queryParams}`;

      try {
        const res = await fetch(url);
        const imoveis = await res.json();

        imoveis.forEach(imovel => {
          const card = `
            <div class="col-md-4 mb-3">
              <div class="card">
                <img src="https://via.placeholder.com/400x200" class="card-img-top" alt="Imagem do imóvel">
                <div class="card-body">
                  <h5 class="card-title">${imovel.nome}</h5>
                  <p class="card-text">${imovel.descricao}</p>
                  <p class="card-text"><strong>R$ ${imovel.preco}</strong></p>
                  <p class="card-text">
                    ${imovel.endereco
                      ? `${imovel.endereco.cidade || ''}, ${imovel.endereco.bairro || ''}<br>${imovel.endereco.rua || ''}, ${imovel.endereco.numero || ''} ${imovel.endereco.complemento || ''}`
                      : ''}
                  </p>
                  <p class="card-text"><strong>Tipo:</strong> ${imovel.tipo || '-'}</p>
                  <p class="card-text"><strong>Situação:</strong> ${imovel.situacao || '-'}</p>
                  <p class="card-text"><strong>Tamanho:</strong> ${imovel.tamanho ? imovel.tamanho + ' m²' : '-'}</p>
                  <p class="card-text"><strong>Data de Cadastro:</strong> ${imovel.dataCadastro || '-'}</p>
                </div>
              </div>
            </div>`;
          resultados.innerHTML += card;
        });
      } catch (err) {
        resultados.innerHTML = '<div class="alert alert-danger">Erro ao buscar imóveis.</div>';
      }
    });
  </script>
  <script>
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const res = await fetch('http://localhost:8081/usuarios/login', {
        method: 'POST',
        body: JSON.stringify(Object.fromEntries(formData)),
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (res.ok) {
        alert('Login realizado com sucesso');
        window.location.href = 'corretor.html';
      } else {
        alert('Login falhou');
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
